# Система автоматической установки принтеров

## Обзор

Система состоит из двух компонентов:
1. **Веб-сервер** (`main.py`) - основной интерфейс для управления принтерами
2. **Плагин** (`PrinterPlugin.exe`) - локальная служба для автоматической установки

## Как это работает

1. Пользователь заходит на веб-страницу
2. Сервер проверяет, установлен ли плагин (порт 8081)
3. Если плагин не установлен - показывается страница установки плагина
4. Если плагин установлен - показывается список принтеров
5. При клике "Установить" - запрос отправляется плагину
6. Плагин выполняет установку принтера в фоновом режиме

## Установка и настройка

### 1. Сборка плагина

```bash
# Установить PyInstaller (если не установлен)
pip install pyinstaller

# Собрать плагин
python build_plugin.py
```

Плагин будет создан в `static/publish/PrinterPlugin.exe`

### 2. Запуск системы

```bash
# Запустить веб-сервер
python main.py
```

Сервер будет доступен по адресу: http://127.0.0.1:8080

### 3. Установка плагина пользователем

1. Пользователь заходит на веб-страницу
2. Если плагин не установлен, показывается страница установки
3. Пользователь скачивает `PrinterPlugin.exe`
4. Запускает файл и разрешает установку
5. Плагин автоматически запускается в фоновом режиме

## API Endpoints

### Веб-сервер (порт 8080)

- `GET /api/plugin-status` - проверка статуса плагина
- `GET /api/scan` - получение списка принтеров
- `POST /api/install` - запрос на установку (проксирует к плагину)
- `GET /dl/plugin` - скачивание плагина
- `GET /dl/installer` - скачивание инсталлятора принтера

### Плагин (порт 8081)

- `GET /status` - статус службы
- `GET /health` - health check
- `POST /install` - установка принтера

## Структура файлов

```
project/
├── main.py                 # Веб-сервер
├── plugin_service.py       # Исходный код плагина
├── build_plugin.py         # Скрипт сборки плагина
├── static/
│   ├── index.html          # Главная страница
│   ├── plugin-install.html # Страница установки плагина
│   ├── js/
│   │   ├── app.js          # Основная логика
│   │   ├── app-plugin.js   # Логика работы с плагином
│   │   └── app-downloads.js # Логика скачивания
│   └── publish/
│       ├── PrinterPlugin.exe # Собранный плагин
│       └── *.exe            # Инсталляторы принтеров
└── files-db.json           # База данных файлов
```

## Безопасность

- Плагин работает только локально (127.0.0.1:8081)
- Не передает данные в интернет
- Требует права администратора для установки принтеров
- Логирует все операции в `plugin.log`

## Логирование

- Веб-сервер: вывод в консоль
- Плагин: файл `plugin.log` + консоль

## Расширение функциональности

### Добавление новых моделей принтеров

1. Добавить файлы инсталляторов в `static/publish/`
2. Обновить `files-db.json`:
```json
{
  "NEW_MODEL": {
    "all": "NEW_MODEL_all.exe",
    "printer": "NEW_MODEL_p.exe",
    "scanner": "NEW_MODEL_s.exe"
  }
}
```
3. Обновить `model_mapping` в `plugin_service.py`

### Настройка портов

В `main.py`:
```python
PLUGIN_PORT = 8081  # Порт плагина
```

В `plugin_service.py`:
```python
PORT = 8081  # Порт плагина
```

## Устранение неполадок

### Плагин не запускается
- Проверьте, что порт 8081 свободен
- Запустите плагин от имени администратора
- Проверьте логи в `plugin.log`

### Веб-сервер не видит плагин
- Убедитесь, что плагин запущен
- Проверьте подключение: `telnet 127.0.0.1 8081`
- Перезапустите веб-сервер

### Ошибки установки принтеров
- Проверьте права доступа
- Убедитесь, что файлы инсталляторов существуют
- Проверьте логи плагина
